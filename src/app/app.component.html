<div class="dnd-character-creator">
  <div class="header">
    <h1>D&D 5e Character Creator</h1>
    <p>Create your character using the Dungeons & Dragons 5th Edition API</p>
  </div>

  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
  </div>

  <!-- Character Creation Form -->
  <form [formGroup]="characterForm" (ngSubmit)="onSubmit()" *ngIf="!characterData">
    <div class="form-container">
      <div class="form-section">
        <h2>Character Basics</h2>
        
        <!-- Character Name -->
        <fluent-field label-position="above">
          <label slot="label" for="character-name">Character Name</label>
          <fluent-text-input 
            ngDefaultControl
            slot="input" 
            id="character-name" 
            formControlName="name" 
            [attr.aria-invalid]="f['name'].invalid && f['name'].touched ? true : null">
          </fluent-text-input>
        </fluent-field>
        <div *ngIf="f['name'].invalid && f['name'].touched" class="validation-error">
          <div *ngIf="f['name'].errors?.['required']">Name is required</div>
          <div *ngIf="f['name'].errors?.['minlength']">Name must be at least 2 characters</div>
        </div>
        
        <!-- Character Class -->
        <fluent-field label-position="above" *ngIf="dndClasses.length > 0">
          <label slot="label">Character Class</label>
          <fluent-radio-group
            ngDefaultControl
            slot="input"
            aria-labelledby="class-label"
            name="character-class"
            formControlName="class"
          >
            <div *ngFor="let dndClass of dndClasses">
              <fluent-field label-position="after">
                <label slot="label">{{ dndClass.name }}</label>
                <fluent-radio
                  slot="input"
                  name="character-class"
                  [value]="dndClass.index"
                ></fluent-radio>
              </fluent-field>
            </div>
          </fluent-radio-group>
        </fluent-field>
        <div *ngIf="dndClasses.length === 0" class="loading-indicator">
          Loading character classes...
        </div>
        <div *ngIf="f['class'].invalid && f['class'].touched" class="validation-error">
          <div *ngIf="f['class'].errors?.['required']">Class selection is required</div>
        </div>
        
        <!-- Character Background -->
        <fluent-field label-position="above" *ngIf="dndBackgrounds.length > 0">
          <label slot="label">Character Background</label>
          <fluent-radio-group
            ngDefaultControl
            slot="input"
            aria-labelledby="background-label"
            name="character-background"
            formControlName="background"
          >
            <div *ngFor="let background of dndBackgrounds">
              <fluent-field label-position="after">
                <label slot="label">{{ background.name }}</label>
                <fluent-radio
                  slot="input"
                  name="character-background"
                  [value]="background.index"
                ></fluent-radio>
              </fluent-field>
            </div>
          </fluent-radio-group>
        </fluent-field>
        <div *ngIf="dndBackgrounds.length === 0" class="loading-indicator">
          Loading backgrounds...
        </div>
      </div>
      
      <div class="form-section">
        <h2>Ability Scores</h2>
        <p>Set your character's ability scores</p>
        
        <!-- Strength -->
        <fluent-field label-position="above">
          <label slot="label" for="strength">Strength</label>
          <fluent-text-input 
            ngDefaultControl
            slot="input" 
            id="strength" 
            type="number" 
            formControlName="strength"
            min="3"
            max="20">
          </fluent-text-input>
        </fluent-field>
        <div *ngIf="f['strength'].invalid && f['strength'].touched" class="validation-error">
          <div *ngIf="f['strength'].errors?.['required']">Strength is required</div>
          <div *ngIf="f['strength'].errors?.['min'] || f['strength'].errors?.['max']">
            Strength must be between 3 and 20
          </div>
        </div>
        
        <!-- Dexterity -->
        <fluent-field label-position="above">
          <label slot="label" for="dexterity">Dexterity</label>
          <fluent-text-input 
            ngDefaultControl
            slot="input" 
            id="dexterity" 
            type="number" 
            formControlName="dexterity"
            min="3"
            max="20">
          </fluent-text-input>
        </fluent-field>
        
        <!-- Constitution -->
        <fluent-field label-position="above">
          <label slot="label" for="constitution">Constitution</label>
          <fluent-text-input 
            ngDefaultControl
            slot="input" 
            id="constitution" 
            type="number" 
            formControlName="constitution"
            min="3"
            max="20">
          </fluent-text-input>
        </fluent-field>
        
        <!-- Intelligence -->
        <fluent-field label-position="above">
          <label slot="label" for="intelligence">Intelligence</label>
          <fluent-text-input 
            ngDefaultControl
            slot="input" 
            id="intelligence" 
            type="number" 
            formControlName="intelligence"
            min="3"
            max="20">
          </fluent-text-input>
        </fluent-field>
        
        <!-- Wisdom -->
        <fluent-field label-position="above">
          <label slot="label" for="wisdom">Wisdom</label>
          <fluent-text-input 
            ngDefaultControl
            slot="input" 
            id="wisdom" 
            type="number" 
            formControlName="wisdom"
            min="3"
            max="20">
          </fluent-text-input>
        </fluent-field>
        
        <!-- Charisma -->
        <fluent-field label-position="above">
          <label slot="label" for="charisma">Charisma</label>
          <fluent-text-input 
            ngDefaultControl
            slot="input" 
            id="charisma" 
            type="number" 
            formControlName="charisma"
            min="3"
            max="20">
          </fluent-text-input>
        </fluent-field>
      </div>
      
      <div class="form-section">
        <h2>Equipment</h2>
        <p>Choose your starting equipment</p>
        
        <div *ngIf="equipment.length > 0" class="equipment-list">
          <div *ngFor="let item of equipment">
            <fluent-field label-position="after">
              <label slot="label">{{ item.name }}</label>
              <fluent-checkbox
                ngDefaultControl
                slot="input"
                [value]="item.index"
                (change)="onEquipmentChange($event)"
              ></fluent-checkbox>
            </fluent-field>
          </div>
        </div>
        <div *ngIf="equipment.length === 0" class="loading-indicator">
          Loading equipment...
        </div>
      </div>
    </div>
    
    <div class="form-actions">
      <fluent-button appearance="accent" type="submit" [disabled]="characterForm.invalid">
        Create Character
      </fluent-button>
      <fluent-button appearance="outline" type="button" (click)="resetForm()">
        Reset Form
      </fluent-button>
    </div>
  </form>
  
  <!-- Character Display -->
  <div *ngIf="characterData && classDetails" class="character-sheet">
    <h2>{{ characterData.name }} - Level 1 {{ classDetails.name }}</h2>
    
    <div class="character-details">
      <div class="ability-scores">
        <h3>Ability Scores</h3>
        <div class="ability-grid">
          <div class="ability-score">
            <strong>STR</strong>
            <div class="score">{{ characterData.strength }}</div>
            <div class="modifier">{{ getModifier(characterData.strength) }}</div>
          </div>
          <div class="ability-score">
            <strong>DEX</strong>
            <div class="score">{{ characterData.dexterity }}</div>
            <div class="modifier">{{ getModifier(characterData.dexterity) }}</div>
          </div>
          <div class="ability-score">
            <strong>CON</strong>
            <div class="score">{{ characterData.constitution }}</div>
            <div class="modifier">{{ getModifier(characterData.constitution) }}</div>
          </div>
          <div class="ability-score">
            <strong>INT</strong>
            <div class="score">{{ characterData.intelligence }}</div>
            <div class="modifier">{{ getModifier(characterData.intelligence) }}</div>
          </div>
          <div class="ability-score">
            <strong>WIS</strong>
            <div class="score">{{ characterData.wisdom }}</div>
            <div class="modifier">{{ getModifier(characterData.wisdom) }}</div>
          </div>
          <div class="ability-score">
            <strong>CHA</strong>
            <div class="score">{{ characterData.charisma }}</div>
            <div class="modifier">{{ getModifier(characterData.charisma) }}</div>
          </div>
        </div>
      </div>
      
      <div class="class-details">
        <h3>Class Features</h3>
        <div class="hit-points">
          <strong>Hit Dice:</strong> 1d{{ classDetails.hit_die }}
        </div>
        <div class="proficiencies">
          <h4>Proficiencies:</h4>
          <ul>
            <li *ngFor="let prof of classDetails.proficiencies">
              {{ prof.name }}
            </li>
          </ul>
        </div>
        <div class="saving-throws">
          <h4>Saving Throws:</h4>
          <ul>
            <li *ngFor="let save of classDetails.saving_throws">
              {{ save.name }}
            </li>
          </ul>
        </div>
      </div>
      
      <div class="equipment-details" *ngIf="characterData.equipment && characterData.equipment.length > 0">
        <h3>Equipment</h3>
        <ul>
          <li *ngFor="let eq of characterData.equipment">{{ eq }}</li>
        </ul>
      </div>
    </div>
    
    <div class="character-actions">
      <fluent-button appearance="accent" (click)="resetForm()">
        Create Another Character
      </fluent-button>
    </div>
  </div>
  
  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading-overlay">
    <div class="loading-spinner">Loading...</div>
  </div>
</div>

<!-- Two-way Binding Test Section -->
<div class="binding-test" *ngIf="!characterData">
  <h2>Two-way Binding Test</h2>
  <div class="binding-test-container">
    <div class="binding-test-item">
      <h3>Text Input</h3>
      <fluent-field label-position="above">
        <label slot="label">Text Input Test</label>
        <fluent-text-input 
          ngDefaultControl
          slot="input" 
          [(ngModel)]="testTextValue" 
          name="testText">
        </fluent-text-input>
      </fluent-field>
      <p>Current value: <strong>{{ testTextValue }}</strong></p>
    </div>

    <div class="binding-test-item">
      <h3>Checkbox Test</h3>
      <fluent-field label-position="after">
        <label slot="label">Checkbox Test</label>
        <fluent-checkbox
          ngDefaultControl
          slot="input"
          [checked]="testCheckboxValue"
          (change)="onCheckboxChange($event)"
          name="testCheckbox">
        </fluent-checkbox>
      </fluent-field>
      <p>Current value: <strong>{{ testCheckboxValue ? 'Checked' : 'Unchecked' }}</strong></p>
    </div>

    <div class="binding-test-item">
      <h3>Radio Group Test</h3>
      <fluent-field label-position="above">
        <label slot="label">Radio Group Test</label>
        <fluent-radio-group
          ngDefaultControl
          slot="input"
          [(ngModel)]="testRadioValue"
          name="testRadio">
          <fluent-field label-position="after">
            <label slot="label">Option 1</label>
            <fluent-radio
              slot="input"
              name="testRadio"
              value="option1">
            </fluent-radio>
          </fluent-field>
          <fluent-field label-position="after">
            <label slot="label">Option 2</label>
            <fluent-radio
              slot="input"
              name="testRadio"
              value="option2">
            </fluent-radio>
          </fluent-field>
          <fluent-field label-position="after">
            <label slot="label">Option 3</label>
            <fluent-radio
              slot="input"
              name="testRadio"
              value="option3">
            </fluent-radio>
          </fluent-field>
        </fluent-radio-group>
      </fluent-field>
      <p>Current value: <strong>{{ testRadioValue || 'None selected' }}</strong></p>
    </div>
  </div>

  <div class="binding-controls">
    <fluent-button appearance="accent" (click)="setTestValues()">Set Test Values</fluent-button>
    <fluent-button appearance="outline" (click)="resetTestValues()">Reset Test Values</fluent-button>
  </div>
</div>

<style>
  .dnd-character-creator {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
    color: #333;
  }
  
  .header {
    text-align: center;
    margin-bottom: 2rem;
  }
  
  .header h1 {
    margin-bottom: 0.5rem;
    color: #7b2cbf;
  }
  
  .form-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
  }
  
  .form-section {
    background-color: #f9f9f9;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }
  
  .form-section h2 {
    margin-top: 0;
    color: #5a189a;
    border-bottom: 2px solid #9d4edd;
    padding-bottom: 0.5rem;
    margin-bottom: 1.5rem;
  }
  
  fluent-field {
    margin-bottom: 1rem;
    display: block;
  }
  
  .validation-error {
    color: #d00000;
    font-size: 0.875rem;
    margin-top: -0.5rem;
    margin-bottom: 1rem;
  }
  
  .form-actions {
    margin-top: 2rem;
    display: flex;
    gap: 1rem;
    justify-content: center;
  }
  
  .character-sheet {
    background-color: #f9f9f9;
    border-radius: 8px;
    padding: 2rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  .character-sheet h2 {
    color: #5a189a;
    border-bottom: 2px solid #9d4edd;
    padding-bottom: 0.5rem;
    margin-bottom: 1.5rem;
  }
  
  .character-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
  }
  
  .ability-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }
  
  .ability-score {
    background-color: #e0aaff;
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
  }
  
  .ability-score .score {
    font-size: 1.5rem;
    font-weight: bold;
  }
  
  .ability-score .modifier {
    background-color: #7b2cbf;
    color: white;
    border-radius: 50%;
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0.5rem auto 0;
  }
  
  .character-actions {
    margin-top: 2rem;
    text-align: center;
  }
  
  .error-message {
    background-color: #ffccd5;
    color: #d00000;
    padding: 1rem;
    border-radius: 4px;
    margin-bottom: 1.5rem;
  }
  
  .loading-indicator {
    color: #666;
    font-style: italic;
  }
  
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }
  
  .loading-spinner {
    background-color: white;
    padding: 2rem;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .binding-test {
    margin-top: 2rem;
    background-color: #f0f0f0;
    padding: 1.5rem;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .binding-test h2 {
    color: #5a189a;
    margin-top: 0;
    border-bottom: 2px solid #9d4edd;
    padding-bottom: 0.5rem;
    margin-bottom: 1.5rem;
  }

  .binding-test-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
  }

  .binding-test-item {
    background-color: white;
    padding: 1rem;
    border-radius: 6px;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
  }

  .binding-test-item h3 {
    color: #7b2cbf;
    margin-top: 0;
    margin-bottom: 1rem;
  }

  .binding-controls {
    margin-top: 1.5rem;
    display: flex;
    gap: 1rem;
    justify-content: center;
  }
</style>
